<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SiakAlfa Code Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Using a standard monospace font stack for a consistent, code-like appearance */
        body {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        }
        /* Custom scrollbar for a cleaner look in the code area */
        textarea::-webkit-scrollbar {
            width: 8px;
        }
        textarea::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        textarea::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        textarea::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-3xl bg-white rounded-xl shadow-lg p-6 md:p-8 space-y-6">
        <!-- Header -->
        <div>
            <h1 class="text-2xl md:text-3xl font-bold text-gray-800">SiakAlfa</h1>
            <p class="text-gray-600 mt-1">Add or remove course codes below to generate your custom script.</p>
        </div>

        <!-- Guide Section -->
        <div class="bg-blue-50 border-l-4 border-blue-400 text-blue-800 p-4 rounded-r-lg" role="alert">
            <p class="font-bold">Course Code Guide</p>
            <p class="mt-1">The format is <strong>[Course Code]-[SKS]</strong>. For example, in <strong>784131-4</strong>:</p>
            <ul class="list-disc list-inside mt-2 text-sm">
                <li>The numbers before the dash (e.g., <code class="bg-gray-200 px-1 rounded">784131</code>) are the actual <strong>course code</strong>.</li>
                <li>The number after the dash (e.g., <code class="bg-gray-200 px-1 rounded">4</code>) is the <strong>jumlah SKS</strong> (credit hours).</li>
            </ul>
        </div>

        <!-- Input Section -->
        <div class="space-y-4">
            <label class="block text-sm font-medium text-gray-700">Course Codes</label>
            <div id="courseInputsContainer" class="space-y-2">
                <!-- Dynamic course code inputs will be inserted here -->
            </div>
            <button id="addCodeButton" class="w-full px-4 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 transition-all duration-200 ease-in-out text-sm">
                + Add Course
            </button>
        </div>

        <!-- Code Display and Copy Section -->
        <div class="space-y-2">
            <div class="flex justify-between items-center">
                <label for="generatedCode" class="block text-sm font-medium text-gray-700">Generated Code</label>
                <button id="copyButton" class="px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200 ease-in-out text-sm">
                    Copy to Clipboard
                </button>
            </div>
            <textarea id="generatedCode" readonly class="w-full h-80 p-4 border border-gray-300 rounded-lg bg-gray-50 font-mono text-sm text-gray-800 resize-none focus:outline-none"></textarea>
        </div>
         <!-- Footer Message -->
        <div class="text-center text-xs text-gray-400 pt-4">
            <p>This tool generates a Tampermonkey userscript. Paste the copied code into a new script in your Tampermonkey dashboard.</p>
        </div>
    </div>

    <script>
        // Get references to the DOM elements
        const courseInputsContainer = document.getElementById('courseInputsContainer');
        const addCodeButton = document.getElementById('addCodeButton');
        const generatedCodeTextarea = document.getElementById('generatedCode');
        const copyButton = document.getElementById('copyButton');

        // The template for the userscript. Uses a simple placeholder __MATKUL_CODES__ which will be replaced.
        const codeTemplate = `// ==UserScript==
// @id             SiakAlfa
// @name           SiakAlfa
// @namespace      http://tampermonkey.net/
// @version        1.1.0
// @description    This userscript lets you win SiakWar
// @author         hockyy
// @match          https://academic.ui.ac.id/main/CoursePlan/CoursePlanEdit
// ==/UserScript==

(function() {
    var i, j, now;
    var matkul_code = [__MATKUL_CODES__];
    var matkul_len = matkul_code.length;
    var cnt = 0;
    console.log('Matkul picked :')
    for(i = 0;i < matkul_len;i++){
        console.log(matkul_code[i])
    }
    console.log(matkul_len)
    for (i = 0;i <= 800;i++){
        now = 'c'+i.toString();
        // console.log(now)
        if(document.getElementById(now) == null) continue;
        console.log(now+' exists');
        for(j = 0;j < matkul_len;j++){
            if(document.getElementById(now).value != matkul_code[j]) continue;
            console.log("Found ! " + matkul_code[j] + " " + now);
            cnt++
            console.log("Clicking !");
            if(!document.getElementById(now).checked){
                document.getElementById(now).click();
            }
            break;
        }
    }
    var scrollingElement = (document.scrollingElement || document.body);
    scrollingElement.scrollTop = scrollingElement.scrollHeight;
    alert("Is Done! Checked "+cnt);
})();`;

        /**
         * Updates the generated code in the textarea based on the current input fields.
         */
        function updateCode() {
            // Get all the input elements for course codes
            const codeInputs = courseInputsContainer.querySelectorAll('input');
            
            // Create an array of the values from the inputs
            const codesArray = Array.from(codeInputs)
                .map(input => input.value.trim()) // Get the value and trim whitespace
                .filter(code => code) // Filter out any empty strings
                .map(code => '"' + code + '"'); // Wrap each code in quotes using standard concatenation

            // Join the array of quoted strings with a comma and a space
            const formattedCodes = codesArray.join(', ');

            // Replace the placeholder in the template with the formatted codes
            const finalCode = codeTemplate.replace('__MATKUL_CODES__', formattedCodes);

            // Set the textarea's value to the final generated code
            generatedCodeTextarea.value = finalCode;
        }

        /**
         * Creates and adds a new input field for a course code.
         * @param {string} [value=''] - The initial value for the input field.
         */
        function addCourseInput(value = '') {
            const inputWrapper = document.createElement('div');
            inputWrapper.className = 'flex items-center space-x-2';

            const newInput = document.createElement('input');
            newInput.type = 'text';
            newInput.className = 'w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition';
            newInput.placeholder = 'e.g., 784131-4';
            newInput.value = value;
            newInput.addEventListener('input', updateCode);

            const removeButton = document.createElement('button');
            removeButton.textContent = 'âˆ’';
            removeButton.className = 'px-3 py-1 bg-red-500 text-white font-bold rounded-full hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500';
            removeButton.addEventListener('click', () => {
                inputWrapper.remove();
                updateCode();
            });

            inputWrapper.appendChild(newInput);
            inputWrapper.appendChild(removeButton);
            courseInputsContainer.appendChild(inputWrapper);
        }

        /**
         * Copies the content of the generated code textarea to the clipboard.
         */
        function copyToClipboard() {
            generatedCodeTextarea.select();
            generatedCodeTextarea.setSelectionRange(0, 99999); // For mobile devices

            try {
                document.execCommand('copy');
                
                const originalText = copyButton.textContent;
                copyButton.textContent = 'Copied!';
                copyButton.classList.add('bg-green-500', 'hover:bg-green-600');
                copyButton.classList.remove('bg-blue-600', 'hover:bg-blue-700');

                setTimeout(() => {
                    copyButton.textContent = originalText;
                    copyButton.classList.remove('bg-green-500', 'hover:bg-green-600');
                    copyButton.classList.add('bg-blue-600', 'hover:bg-blue-700');
                }, 2000);

            } catch (err) {
                console.error('Failed to copy text: ', err);
                console.error('Failed to copy text. Please try again or copy manually.');
            }

            window.getSelection().removeAllRanges();
        }

        // --- Event Listeners ---
        addCodeButton.addEventListener('click', () => addCourseInput());
        copyButton.addEventListener('click', copyToClipboard);
        
        // --- Initial Setup ---
        // Start with 5 empty input fields.
        const numberOfInitialInputs = 5;
        for (let i = 0; i < numberOfInitialInputs; i++) {
            addCourseInput();
        }
        
        // Trigger the update function once on load to populate the textarea initially
        updateCode();
    </script>

</body>
</html>
